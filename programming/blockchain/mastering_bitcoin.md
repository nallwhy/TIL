# Mastering Bitcoin

가치를 보관하고 전송.

사용자들은 거래에 대한 소유권을 입증할 수 있는 키를 소유해 암호를 풀어 소비하고 새로운 수신자에게 전송.


## 비트코인 시작하기

### 디지털 통화의 문제점

- 위조가 아닌지 신뢰할 수 있는가?
- 내 돈을 다른 사람이 자신의 소유라고 주장할 수 있을 가능성이 있는가? (이중 지불 문제)

디지털 서명 (암호화)를 이용해 해결

### 구성 요소

- 분산화된 P2P 네트워크 (비트코인 프로토콜)
- 공개 거래 장부 (블록체인)
- 분산화된 수학적 결정론적 통화 발행 (분산 채굴)
- 분산화된 거래 검증 시스템 (거래 스크립트)

### 역사

매 10분 마다 투표를 위해, 분산 연산 시스템(작업 증명 알고리즘)을 사용해서 분산 네트워크가 각 거래 상태에 대해 합의(consensus)에 이를 수 있도록 했다. => 이중 지불 문제 해결

### Byzantine Generals' problem

신뢰성이 없고 임시로 구성된 네트워크상에서 정보 교환을 통해 행동방침에 대해 동의를 구할 수 있으려면?
=> 작업증명으로 해결.


## 비트코인의 작동 원리

### 거래

입력값 >= 출력값 (차이는 fee)

#### 일반 유형

##### Common Transaction

단일 거래. 남는 돈은 새로운 지갑으로 들어온다.

##### Aggregation Transaction

여러 개의 입력값을 하나로 합침. 지갑 정리 등

##### Distributing Transaction

하나의 입력값을 여러 명의 수신인에게. 급여 지불 등

#### 거래의 구성

##### 올바른 입력값 얻기

전송하기를 원하는 금액을 지불할 수 있도록 알맞은 입력값 찾기.

lightweight client: 본인의 unspent transaction output 만 추적함

##### 출력값 생성하기

수신인의 공개키에 대응하는 키(비밀키)를 이용해 서명하는 누구에게나 지불 가능하다는 출력값.

수수료는 명시되어있지 않고 입력값과 출력값의 차이로 알 수 있다.

##### 거래내역을 장부에 추가하기

해당 거래가 분산장부(blockchain)의 일부가 되기 위해 비트코인 네트워크로 전송되어야 함.

###### 거래 전파하기

P2P 네트워크를 통해 거래내역을 참여자 전원에게 전파.

노드들(다른 고객들)은 이전에는 없던 유효한 거래를 전송받으면 즉시 연결되어 있는 다른 노드로 해당 거래를 전달.

###### 수신자 입장에서 거래 살펴보기

수신자의 지갑은 수신자의 비밀키로 사용 가능한 출력값을 파악.

수신자의 지갑 어플리케이션은 이 거래가 잘 생성되었고 이전에 소비도지 않은 입력값을 사용했으며 다음 블록에 포함된 거래 수수료를 충분히 보유하고 있는지 스스로 확인할 수 있다.

수신자는 별다른 위험 요소 없이 이 거래가 즉시 블록에 포함되어 승인될 것이라고 추정할 수 있음.

> 흔한 오해로 새롭게 생성된 블록에 대해 10분을 기다리거나 수 번의 confirm 을 받야야 한다고 생각하는데, 소액 결제에 대해서는 시간을 지연시킬 필요가 없다. 이 경우 신용카드 결제가 신분증이나 서명 없이 이루어질 때의 위험도와 유사한 정도라고 보면 된다.

### 채굴

Transaction 이 전파 되었어도, 거래가 검증되고 mining 을 거쳐 블록에 포함될 때까지는 블록체인의 일부가 되지 못한다.

거래를 입증해서 블록을 생성하기 위해서는 수학적 계산의 규모가 엄청나지만 입증된 후에는 검증을 위해서 그다지 많은 계산을 하지 않아도 된다.

채굴의 목적
- 돈으르 새로 발행하는 중앙은행처럼 각 블록 내에서 새 비트코인을 생성. 한 블록당 생성되는 비트코인의 양은 고정되어 있고 시간이 지나면서 줄어든다.
- 거래르 담고 있는 블록이 충분한 연산력을 사용하여 승인되었다는 것이 확인되었을 때만 신뢰가 생긴다.

#### 채굴하기

비트코인 네트워크의 각 노드들은 temporary pool 을 유지하며 새로운 거래들을 추가한다. 채굴자들이 temporary pool 에 속해 있는 미검증 거래들을 추가해 새 블록을 만들어 유효성을 입증하기 위해 작업인증을 한다.

거래들이 새 블록에 추가될 때는 거래 수수료가 가장 높은 거래부터 우선순위를 가진다(몇몇 예외도 존재). 각 채굴자는 네트워크로부터 이전 블록을 받게 되면 채굴에 실패했다는 것을 알게 되고 바로 새 블록을 채굴하기 시작.

각 채굴자는 자신이 채굴하고 있는 블록 안에 자신 소유의 비트코인 주소에 새롭게 생성된 비트코인을 보상으로 받는 거래를 포함하고 있음.

새 블록이 채굴될 때마다 이전 블록을 기반으로 하기 때문에 이전 블록들에 더 많은 연산들이 추가되는 꼴. 이를 통해 거래들의 신뢰도가 높아짐. 이를 confirm 이라함.

관례상 6회 이상의 confirm 은 취소 불가능 한 것으로 간주.

#### 거래 소비하기

각 비트코인 클라이언트는 거래가 유효하고 사용 가능한지 독립적으로 검증할 수 있다.

풀인덱스 클라이언트: 특정 비트코인이 블록으로부터 처음 발생하여 현재 블록까지 거래되어온 돈의 출처를 추적할 수 있다.

라이트웨이트 클라이언트: 해당 거래가 블록체인 내에 존재하고 그 후 채굴된 블록이 여러 개 있다는 점을 승인함으로써 단순지불검증(Simple payment Verification)을 시행할 수 있다. 이를 통해 해당 네트워크가 해당 거래를 유효하다고 수락했음을 확증할 수 있다.


## 비트코인 클라이언트

###
